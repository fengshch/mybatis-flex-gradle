/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Gradle plugin project to get you started.
 * For more details on writing Custom Plugins, please refer to https://docs.gradle.org/8.3/userguide/custom_plugins.html in the Gradle documentation.
 */

plugins {
    // Apply the Java Gradle plugin development plugin to add support for developing Gradle plugins
    id 'java-gradle-plugin'
    id 'maven-publish'
    id 'idea'
}

group = GROUP
version = VERSION

java {
    sourceCompatibility = '21'
    withJavadocJar() // Generates javadocJar automatically
    withSourcesJar() // Generates sourcesJar automatically
}


repositories {
    // Use Maven Central for resolving dependencies.
    mavenCentral()
    gradlePluginPortal()
}

dependencies {

    implementation(libs.mybatisFlexCodegen)

    implementation(libs.flywaydbGradlePluginPublishing)

    implementation(libs.hikariCP)

    implementation(libs.snakeyaml)

    implementation(libs.freemarker)

    implementation(libs.commonsLang3)

    compileOnly(libs.lombok)

    testCompileOnly(libs.lombok)

    annotationProcessor(libs.lombok)

    testImplementation(libs.h2)

    testImplementation(libs.junitJupiter)

    testRuntimeOnly(libs.junitPlatformLauncher)
}

gradlePlugin {
    plugins {
        greeting {
            id = 'com.github.fengshch.mybatis-flex-gradle-plugin'
            implementationClass = 'com.github.fengshch.mybatis.MyBatisFlexGradlePlugin'
        }
    }
}

publishing {
//    publications {
//        create("mavenJava", MavenPublication) {
//            from components.java
//
////            // Ensure sourcesJar and javadocJar tasks exist
////            artifact(tasks.named("sourcesJar"))
////            artifact(tasks.named("javadocJar"))
//
//            // Custom POM
//            pom {
//                name.set("MyBatis Flex Gradle Plugin")
//                description.set("A Gradle plugin for MyBatis Flex code generation")
//                url.set("https://github.com/fengshch/mybatis-flex-gradle-plugin")
//
//                licenses {
//                    license {
//                        name.set("Apache-2.0")
//                        url.set("https://opensource.org/licenses/Apache-2.0")
//                    }
//                }
//                developers {
//                    developer {
//                        id.set("fengshch")
//                        name.set("Bill Feng")
//                        email.set("fengshch@gmail.com")
//                    }
//                }
//                scm {
//                    connection.set("scm:git:git://github.com/fengshch/mybatis-flex-gradle-plugin.git")
//                    developerConnection.set("scm:git:ssh://github.com/fengshch/mybatis-flex-gradle-plugin.git")
//                    url.set("https://github.com/fengshch/mybatis-flex-gradle-plugin")
//                }
//            }
//        }
//    }
    repositories {
        maven {
            name = "maven-release"
            def releasesRepoUrl = uri("http://172.16.12.219:8081/repository/maven-releases/")
            def snapshotsRepoUrl = uri("http://172.16.12.219:8081/repository/maven-snapshots/")
            def isSnapshot = project.version?.toString()?.endsWith("SNAPSHOT") ?: false
            url = isSnapshot ? snapshotsRepoUrl : releasesRepoUrl
            allowInsecureProtocol=true

            credentials {
                username = findProperty("NexusUser") ?: System.getenv("NEXUS_USER") ?: ""
                password = findProperty("NexusPassword") ?: System.getenv("NEXUS_PASSWORD") ?: ""
            }
        }
    }
}


idea {
    module {
        downloadJavadoc = true
        downloadSources = true
    }
}